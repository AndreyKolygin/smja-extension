<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="./css/common.css">
  <link rel="stylesheet" href="./css/options.css">
  <title>JDA — Settings</title>
</head>
<body>
  <div class="options container ">
    <h1 data-i18n="ui.app.title">Job description Analyzer — Settings</h1>
        <div class="card">
        <h2 data-i18n="options.title.lang"></h2>
        <div class="form-row">
          <label for="uiLang" data-i18n="options.lang.label">Interface language</label>
            <select id="uiLang">
            <option value="en">English</option>
            <option value="ru">Русский</option>
            <!-- добавляй другие языки -->
          </select>
          <p class="muted" data-i18n="options.lang.hint">Choose UI language (applies to popup & options)</p>
        </div>
    </div>
    <div class="grid mt-16">
      <div class="card card_llm">
        <h2 data-i18n="options.title.llmSettings">LLM settings</h2>
        <h3 data-i18n="options.title.providerSettings">Provider settings</h3>
        <p><button class="btn add-model" title="Add LLM provider" id="addProviderBtn" data-i18n="options.btn.addProvider">+ Add provider</button></p>
        <div class="table-wrapper">
          <table class="table" id="providersTable">
          <thead><tr>
            <th data-i18n="options.tbl.name">Name</th>
            <th data-i18n="options.tbl.baseUrl">Base URL</th>
            <!--<th>Type</th>-->
            <th data-i18n="options.tbl.key">Key</th>
            <th></th>
          </tr></thead>
          <tbody></tbody>
        </table>
        </div>
        <h3 data-i18n="options.title.models">Models</h3>
        <p><button class="btn add-model" title="Add model for provider" id="addModelBtn" data-i18n="options.btn.addModel">+ Add model</button></p>
        <div class="table-wrapper">
        <table class="table" id="modelsTable">
          <thead><tr>
            <th data-i18n="options.tbl.active">Active</th>
            <th data-i18n="options.tbl.displayName">Display name</th>
            <th data-i18n="options.tbl.provider">Provider</th>
            <th data-i18n="options.tbl.modelId">Model ID</th>
            <th></th></tr></thead>
          <tbody></tbody>
        </table>
        </div>
        <label data-i18n="options.hint.model1">Model-level system prompt (edit per model)</label>
        <div class="muted" data-i18n="options.hint.model2">Open any model row to edit its system prompt.</div>
      </div>
      
      <div class="card card_sites">
        <h2 data-i18n="options.title.autoExtract">Auto-extract rules</h2>
        <p class="muted" data-i18n="options.title.">Добавьте сайты и CSS-селекторы, чтобы автоматически вытягивать описание вакансии.</p>
        <p><button class="btn add-model" id="addSiteBtn" data-i18n="options.btn.addSiteRule">+ Add site rule</button></p>
        <div class="table-wrapper">
          <table class="table" id="sitesTable">
            <thead>
              <tr>
                <th data-i18n="options.tbl.active">Active</th>
                <th data-i18n="options.tbl.site">Site</th>
                <th data-i18n="options.tbl.selector" class="word-break">Selector</th>
                <th data-i18n="options.tbl.comment">Comment</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="card card_general">
        <h2 data-i18n="options.title.general">General</h2>
        <h3 data-i18n="options.title.cv">CV</h3>
        <textarea class="textInput" id="cv" data-i18n-attr-placeholder="options.cv" placeholder="Your CV"></textarea>

        <h3 data-i18n="options.title.systemPromptTempl">System prompt template</h3>
        <textarea class="textInput" id="systemTemplate"></textarea>
        <div class="muted" data-i18n="options.title.">
          Default included. See templates: <a href="https://github.com/andreykolygin" target="_blank">GitHub</a>.
        </div>

        <h3 data-i18n="options.title.resultOutpTempl">Result output template</h3>
        <textarea class="textInput" id="outputTemplate"></textarea>
        
        <!-- Кнопки сохранения и сбороса кэша -->
        <div class="saveBtn">
          <p>
            <button class="btn danger" id="resetCacheBtn" data-i18n="options.btn.resetPromptCache" disabled>Reset prompt cache</button>
            <span class="muted ml-8" id="resetHint"></span>
          </p>
          <p><button class="btn primary" id="saveBtn" data-i18n="options.btn.saveSettings">Save settings</button></p>
        </div>
        
        
        <!-- кнопки экспорта и импорта -->
        <div id="settingsIO" class="io-row">
          <button id="exportSettingsBtn" class="btn" data-i18n="options.btn.exportSettings">Export settings (JSON)</button>
          <button id="importSettingsBtn" class="btn" data-i18n="options.btn.importSettings">Import settings</button>
          <input id="importSettingsFile" type="file" accept="application/json" class="hidden" />
        </div>
      </div>    
    </div>
  </div>
  </div>


  <!-- Add Provider Modal -->
  <dialog id="providerModal">
    <div class="form-row">
    <form method="dialog">
      <h3>Add provider</h3>
      <label>Choose a provider or create a custom one</label>
      <select id="providerPreset">
        <option value="custom">Custom</option>
        <option value="anthropic">Anthropic</option>
        <option value="azure">Azure OpenAI</option>
        <option value="deepseek">DeepSeek</option>
        <option value="gemini">Google Gemini</option>
        <option value="huggingface">Hugging Face</option>
        <option value="meta">Meta</option>
        <option value="ollama">Ollama</option>
        <option value="openai">OpenAI</option>
        <option value="openrouter">OpenRouter</option>
        <option value="perplexity">Perplexity</option>
        <option value="xai">XAI</option>
      </select>

      <label>Base URL</label>
      <input id="providerBaseUrl" type="text" placeholder="https://api.example.com"/>

      <label>API key</label>
      <input id="providerApiKey" type="text" placeholder="sk-..."/>
      <div class="muted"><a id="apiKeyLink" href="#" target="_blank" rel="noopener noreferrer">Get your API key here</a><br><small id="apiKeyHelp" class="muted"></small></div>

      <menu>
        <button class="btn" value="cancel" data-i18n="options.btn.cancel">Cancel</button>
        <button class="btn primary" id="saveProviderBtn" value="default" data-i18n="options.btn.save">Save</button>
      </menu>
    </form>
    </div>
  </dialog>
  <!-- Add Model Modal -->
  <dialog id="modelModal">
    <form method="dialog">
      <h3>Add model</h3>
      <label>Provider</label>
      <select id="modelProvider"></select>

        <div class="form-row">
          <label for="modelDisplay">Display name</label>
          <input type="text" id="modelDisplay" />
        </div>

        <div class="form-row">
          <label for="modelId">Model ID</label>
          <input type="text" id="modelId" />
        </div>
      <menu>
        <button class="btn" value="cancel" data-i18n="options.btn.cancel">Cancel</button>
        <button class="btn primary" id="saveModelBtn" value="default" data-i18n="options.btn.save">Save</button>
      </menu>
    </form>
  </dialog>

  <!-- Modal: add/edit site rule -->
  <dialog id="siteModal">
    <form method="dialog">
      <h3>Site rule</h3>
      <div class="form-row">
        <label for="siteHost">Site (hostname, wildcard, or /regex/)</label>
        <input type="text" id="siteHost" placeholder="linkedin.com  |  jobs.example.com  |  /(^|\\.)indeed\\.com$/">
      </div>
      <div class="form-row">
        <label for="siteSelector">CSS selector</label>
        <textarea type="text" rows="3" id="siteSelector" placeholder=".job-description, #content, article"></textarea>
      </div>
      <div class="form-row">
        <label for="siteComment">Comment</label>
        <input type="text" id="siteComment" placeholder="LinkedIn JD main panel">
      </div>
      <div class="form-row">
        <label><input type="checkbox" id="siteActive" checked> Active</label>
      </div>

      <menu>
        <button class="btn" value="cancel" id="cancelSiteBtn" data-i18n="options.btn.cancel">Cancel</button>
        <button class="btn primary" id="saveSiteBtn" value="default" data-i18n="options.btn.save">Save</button>
      </menu>
    </form>
  </dialog>

  <dialog id="modelPromptModal" class="modal">
  <form method="dialog" class="modal-body">
    <h3>Edit system prompt</h3>
    <p class="hint">This prompt overrides the global System prompt template for this specific model. Leave empty to inherit the global template.</p>
    <textarea id="modelPromptText" rows="12" class="stretch mono"></textarea>
    <div class="modal-actions">
      <button id="cancelModelPromptBtn" type="reset" class="btn" data-i18n="options.btn.cancel">Cancel</button>
      <button id="saveModelPromptBtn" type="button" class="btn primary" data-i18n="options.btn.save">Save</button>
    </div>
  </form>
</dialog>

  <script type="module" src="./js/options-main.js"></script>
</body>
</html>
